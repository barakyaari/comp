PROCSS:

RETURN_TRUE:
	MOV(R0, SOB_TRUE);
	JUMP(END);

PRINT_R0_VALUE:
	PUSH(FP);
	MOV(FP, SP);
	CMP(R0, SOB_VOID);
	JUMP_EQ(END);
	PUSH(R0);
	CALL(WRITE_SOB);
	DROP(IMM(1));

PRINT_END:
	JUMP(END);

CHECK_BOOL:
	DROP(1);
	CMP(1, R0);
	JUMP(CHECK_BOOL_RESULT);		
		
CHECK_BOOL_RESULT:
	JUMP_EQ(RETURN_TRUE);
	MOV(R0, SOB_FALSE);
	JUMP(END);

#TODO: append (variadic)

#TODO: apply

/**** < var ****/
/**** R1 = Accumulator, R2 = Num of loops, R3 = Index****/
VAR_LESSTHAN:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	PUSH(R3);
	PUSH(R4);
	MOV(R1, 0);
	MOV(R2, FPARG(NUMOFARGS));
	ADD(R2, 2);
	MOV(R3, 2); 	
VAR_LESSTHAN_LOOP:
	CMP(R2, R3);
	JUMP_EQ(VAR_LESSTHAN_END);
	CMP(R3, 2);
	JUMP_NE(VAR_LESSTHAN_LOOP2);
	MOV(R4, FPARG(R3)); /**** Scheme int ****/
	MOV(R1, INDD(R4, 1)); /**** Scheme int number ****/ 	
	ADD(R3, 1);
	JUMP(VAR_LESSTHAN_LOOP);
VAR_LESSTHAN_LOOP2:
	MOV(R4, FPARG(R3)); /**** Scheme int ****/
	CMP(R1, INDD(R4, 1)); /**** Scheme int number ****/  
	JUMP_GE(VAR_LESSTHAN_END);
	ADD(R3, 1);
	MOV(R1, INDD(R4, 1));
	JUMP(VAR_LESSTHAN_LOOP);
VAR_LESSTHAN_END:
	CMP(R2, R3);
	POP(R4);
	POP(R3);
	POP(R2);
	POP(R1);
	JUMP(CHECK_BOOL_RESULT);

/**** = var ****/
/**** R1 = Accumulator, R2 = Num of loops, R3 = Index****/
VAR_EQUAL:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	PUSH(R3);
	PUSH(R4);
	MOV(R1, 0);
	MOV(R2, FPARG(NUMOFARGS));
	ADD(R2, 2);
	MOV(R3, 2); 	
VAR_EQUAL_LOOP:
	CMP(R2, R3);
	JUMP_EQ(VAR_EQUAL_END);
	CMP(R3, 2);
	JUMP_NE(VAR_EQUAL_LOOP2);
	MOV(R4, FPARG(R3)); 
	MOV(R1, INDD(R4, 1)); 	
	ADD(R3, 1);
	JUMP(VAR_EQUAL_LOOP);
VAR_EQUAL_LOOP2:
	MOV(R4, FPARG(R3));
	CMP(R1, INDD(R4, 1)); 
	JUMP_NE(VAR_EQUAL_END);
	ADD(R3, 1);
	JUMP(VAR_EQUAL_LOOP);
VAR_EQUAL_END:
	CMP(R2, R3);
	POP(R4);
	POP(R3);
	POP(R2);
	POP(R1);
	JUMP(CHECK_BOOL_RESULT);

/**** > var ****/
/**** R1 = Accumulator, R2 = Num of loops, R3 = Index****/
VAR_GREATERTHAN:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	PUSH(R3);
	PUSH(R4);
	MOV(R1, 0);
	MOV(R2, FPARG(NUMOFARGS));
	ADD(R2, 2);
	MOV(R3, 2); 	
VAR_GREATERTHAN_LOOP:
	CMP(R2, R3);
	JUMP_EQ(VAR_GREATERTHAN_END);
	CMP(R3, 2);
	JUMP_NE(VAR_GREATERTHAN_LOOP2);
	MOV(R4, FPARG(R3));
	MOV(R1, INDD(R4, 1));
	ADD(R3, 1);
	JUMP(VAR_GREATERTHAN_LOOP);
VAR_GREATERTHAN_LOOP2:
	MOV(R4, FPARG(R3));
	CMP(R1, INDD(R4, 1));
	JUMP_LE(VAR_GREATERTHAN_END);
	ADD(R3, 1);
	MOV(R1, INDD(R4, 1));
	JUMP(VAR_GREATERTHAN_LOOP);
VAR_GREATERTHAN_END:
	CMP(R2, R3);
	POP(R4);
	POP(R3);
	POP(R2);
	POP(R1);
	JUMP(CHECK_BOOL_RESULT);

/**** + var ****/
/**** R1 = Accumulator, R2 = Num of loops, R3 = Index****/
VAR_PLUS:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	PUSH(R3);
	PUSH(R4);
	MOV(R1, 0);
	MOV(R2, FPARG(NUMOFARGS));
	ADD(R2, 2);
	MOV(R3, 2); 	
VAR_PLUS_LOOP:
	CMP(R2, R3);
	JUMP_EQ(VAR_PLUS_END);
	MOV(R4, FPARG(R3));
	ADD(R1, INDD(R4, 1));
	ADD(R3, 1);
	JUMP(VAR_PLUS_LOOP);
VAR_PLUS_END:
	PUSH(R1);
	CALL(MAKE_SOB_INTEGER);
	DROP(1); 
	POP(R4);
	POP(R3);
	POP(R2);
	POP(R1);
	JUMP(END);

/**** / var ****/
/**** R1 = Accumulator, R2 = Num of loops, R3 = Index****/
VAR_DIV:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	PUSH(R3);
	PUSH(R4);
	MOV(R1, 1);
	MOV(R2, FPARG(NUMOFARGS));
	CMP(R2, 1);
	JUMP_NE(VAR_DIV_MORE_THAN_ONE_ARG);
	MOV(R1, 1);
	DIV(R1, INDD(FPARG(2), 1));
	JUMP(VAR_DIV_END);
VAR_DIV_MORE_THAN_ONE_ARG:
	ADD(R2, 2);
	MOV(R3, 2); 	
VAR_DIV_LOOP:
	CMP(R2, R3);
	JUMP_EQ(VAR_DIV_END);
	CMP(R3, 2);
	JUMP_NE(VAR_DIV_LOOP2);
	MOV(R4, FPARG(R3));
	MOV(R1, INDD(R4, 1));	
	ADD(R3, 1);
	JUMP(VAR_DIV_LOOP);
VAR_DIV_LOOP2:
	MOV(R4, FPARG(R3));
	DIV(R1, INDD(R4, 1));
	ADD(R3, 1);
	JUMP(VAR_DIV_LOOP);
VAR_DIV_END:
	PUSH(R1);
	CALL(MAKE_SOB_INTEGER);
	DROP(1); 
	POP(R4);
	POP(R3);
	POP(R2);
	POP(R1);
	JUMP(END);

/**** * var ****/
/**** R1 = Accumulator, R2 = Num of loops, R3 = Index****/
VAR_MUL:
	PUSH(FP);
	MOV(FP, SP);
	MOV(R1, 1);
	MOV(R2, FPARG(NUMOFARGS));
	ADD(R2, 2);
	MOV(R3, 2); 	
VAR_MUL_LOOP:
	CMP(R2, R3);
	JUMP_EQ(VAR_MUL_END);
	MOV(R4, FPARG(R3));
	MUL(R1, INDD(R4, 1));
	ADD(R3, 1);
	JUMP(VAR_MUL_LOOP);
VAR_MUL_END:
	PUSH(R1);
	CALL(MAKE_SOB_INTEGER);
	DROP(1); 
	JUMP(END);

/**** - var ****/
/**** R1 = Accumulator, R2 = Num of loops, R3 = Index****/
VAR_MIN:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	PUSH(R3);
	PUSH(R4);
	MOV(R1, 0);
	MOV(R2, FPARG(NUMOFARGS));
	CMP(R2, 1);
	JUMP_NE(VAR_MIN_MORE_THAN_ONE_ARG);
	MOV(R1, 0);
	SUB(R1, INDD(FPARG(2), 1));
	JUMP(VAR_MIN_END);
VAR_MIN_MORE_THAN_ONE_ARG:
	ADD(R2, 2);
	MOV(R3, 2); 	
VAR_MIN_LOOP:
	CMP(R2, R3);
	JUMP_EQ(VAR_MIN_END);
	CMP(R3, 2);
	JUMP_NE(VAR_MIN_LOOP2);
	MOV(R4, FPARG(R3)); 
	MOV(R1, INDD(R4, 1)); 
	ADD(R3, 1);
	JUMP(VAR_MIN_LOOP);
VAR_MIN_LOOP2:
	MOV(R4, FPARG(R3)); 
	SUB(R1, INDD(R4, 1)); 
	ADD(R3, 1);
	JUMP(VAR_MIN_LOOP);
VAR_MIN_END:
	PUSH(R1);
	CALL(MAKE_SOB_INTEGER);
	DROP(1); 
	POP(R4);
	POP(R3);
	POP(R2);
	POP(R1);
	JUMP(END);


PREDICATS:

ISBOOLEAN:
	PUSH(FP);
	MOV(FP, SP);
	MOV(R0, FPARG(2));
	CMP(IND(R0), T_BOOL);
	JUMP(CHECK_BOOL_RESULT);


ISCHAR:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(FPARG(2));
	CALL(IS_SOB_CHAR);
	JUMP(CHECK_BOOL);

ISNULL:
	PUSH(FP);
	MOV(FP, SP);
	MOV(R0, FPARG(2));
	CMP(R0, SOB_NIL);
	JUMP(CHECK_BOOL_RESULT);

/** TODO: CHECK ABOUT INTEGER/RATIONAL/FRACTION **/
ISNUMBER:
	PUSH(FP);
	MOV(FP, SP);
	MOV(R0, FPARG(2));
	CMP(IND(R0), T_INTEGER);
	JUMP(CHECK_BOOL_RESULT);
/** TODO: is rational is exactly like number? **/
ISRATIONAL:
	PUSH(FP);
	MOV(FP, SP);
	MOV(R0, FPARG(2));
	CMP(IND(R0), T_INTEGER);
	JUMP(CHECK_BOOL_RESULT);	

ISINTEGER:
	PUSH(FP);
	MOV(FP, SP);
	MOV(R0, FPARG(2));
	CMP(IND(R0), T_INTEGER);
	JUMP(CHECK_BOOL_RESULT);

ISPAIR:
	PUSH(FP);
	MOV(FP, SP);
	MOV(R0, FPARG(2));
	CMP(IND(R0), T_PAIR);
	JUMP(CHECK_BOOL_RESULT);

ISSTRING:
	PUSH(FP);
	MOV(FP, SP);
	MOV(R0, FPARG(2));
	CMP(IND(R0), T_STRING);
	JUMP(CHECK_BOOL_RESULT);

ISSYMBOL:
	PUSH(FP);
	MOV(FP, SP);
	MOV(R0, FPARG(2));
	CMP(IND(R0), T_SYMBOL);
	JUMP(CHECK_BOOL_RESULT);			

ISVECTOR:
	PUSH(FP);
	MOV(FP, SP);
	MOV(R0, FPARG(2));
	CMP(IND(R0), T_VECTOR);
	JUMP(CHECK_BOOL_RESULT);
	
ISZERO:
	PUSH(FP);
	MOV(FP, SP);
	MOV(R2, FPARG(2));
	MOV(R2, INDD(R2, 1));
	CMP(R2, 0);
	JUMP(CHECK_BOOL_RESULT);

ISPROCEDURE:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(FPARG(2));
	CALL(IS_SOB_CLOSURE);
	JUMP(CHECK_BOOL);


REMAINDER:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	MOV(R1, FPARG(2));
	MOV(R1, INDD(R1, 1));
	MOV(R2, FPARG(3));
	MOV(R2, INDD(R2, 1));
	REM(R1, R2);
	PUSH(R1);
	CALL(MAKE_SOB_INTEGER);
	DROP(1);
	POP(R2);
	POP(R1);
	JUMP(END);

STRINGS:

STR_LENGTH:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	MOV(R1, FPARG(2));
	MOV(R2, INDD(R1, 1));
	PUSH(R2);
	CALL(MAKE_SOB_INTEGER);
	DROP(1);
	POP(R2);
	POP(R1);
	JUMP(END);

STR_REF:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	MOV(R1, FPARG(2));
	MOV(R2, FPARG(3));
	MOV(R2, INDD(R2, 1));
	ADD(R2, 2);
	MOV(R1, INDD(R1, R2));
	PUSH(R1);
	CALL(MAKE_SOB_CHAR);
	DROP(1);
	POP(R2);
	POP(R1);
	JUMP(END);

STR_SET:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	PUSH(R3);
	MOV(R1, FPARG(2));
	MOV(R2, FPARG(3));
	MOV(R3, FPARG(4));
	MOV(R2, INDD(R2, 1));
	MOV(R3, INDD(R3, 1));
	ADD(R2, 2);
	MOV(INDD(R1, R2), R3);
	MOV(R0, SOB_VOID);
	POP(R3);
	POP(R2);
	POP(R1);
	JUMP(END);

MAKE_STRING:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	PUSH(R5);
	MOV(R1, FPARG(2)); 
	MOV(R1, INDD(R1, 1));
	MOV(R5, FPARG(NUMOFARGS));
	CMP(R5, 1);
	JUMP_EQ(MAKE_STRING_CHAR0);
	MOV(R2, FPARG(3));
	MOV(R2, INDD(R2, 1));
	JUMP(MAKE_STRING_ARG2);
MAKE_STRING_CHAR0:
	PUSH(0);
	CALL(MAKE_SOB_CHAR);
	DROP(1); 
	MOV(R2, R0);	
MAKE_STRING_ARG2:
	MOV(R5, 0);
MAKE_STRING_PUSH_LOOP:
	CMP(R5, R1);
	JUMP_EQ(MAKE_STRING_AFTER_PUSH);
	PUSH(R2);
	ADD(R5, 1);
	JUMP(MAKE_STRING_PUSH_LOOP);
MAKE_STRING_AFTER_PUSH:
	PUSH(R1);
	CALL(MAKE_SOB_STRING);
	POP(R1);
	DROP(R1);
	POP(R5);
	POP(R2);
	POP(R1);
	JUMP(END);

VECTORS:

VECTOR:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	PUSH(R5);
	MOV(R1, FPARG(NUMOFARGS));
	MOV(R5, 0);	
	MOV(R2, 2);
PUSH_VEC_ARGS:
	CMP(R5, R1);
	JUMP_EQ(VECTOR_AFTER_PUSH_ARGS);
	MOV(R3, FPARG(R2));
	PUSH(R3);
	ADD(R5, 1);
	ADD(R2, 1);
	JUMP(PUSH_VEC_ARGS);
VECTOR_AFTER_PUSH_ARGS:
	PUSH(R1);
	CALL(MAKE_SOB_VECTOR);
	POP(R1);
	DROP(R1);
	POP(R5);
	POP(R2);
	POP(R1);
	JUMP(END);	

VEC_LENGTH:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	MOV(R1, FPARG(2));
	MOV(R2, INDD(R1, 1));
	PUSH(R2);
	CALL(MAKE_SOB_INTEGER);
	DROP(1);
	POP(R2);
	POP(R1);
	JUMP(END);

VEC_REF:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	MOV(R1, FPARG(2));
	MOV(R2, FPARG(3));
	MOV(R2, INDD(R2, 1));
	ADD(R2, 2);
	MOV(R1, INDD(R1, R2));
	MOV(R0, R1);
	POP(R2);
	POP(R1);
	JUMP(END);

VEC_SET:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	PUSH(R3);
	MOV(R1, FPARG(2));
	MOV(R2, FPARG(3));
	MOV(R3, FPARG(4));
	MOV(R2, INDD(R2, 1));
	ADD(R2, 2);
	MOV(INDD(R1, R2), R3);
	MOV(R0, SOB_VOID);
	POP(R3);
	POP(R2);
	POP(R1);
	JUMP(END);

MAKE_VECTOR:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	PUSH(R5);
	MOV(R1, FPARG(2)); 
	MOV(R1, INDD(R1, 1));
	MOV(R5, FPARG(NUMOFARGS));
	CMP(R5, 1);
	JUMP_EQ(MAKE_VECTOR_CHAR0);
	MOV(R2, FPARG(3));
	JUMP(MAKE_VECTOR_ARG2);
MAKE_VECTOR_CHAR0:
	PUSH(0);
	CALL(MAKE_SOB_INTEGER);
	DROP(1); 
	MOV(R2, R0);	
MAKE_VECTOR_ARG2:
	MOV(R5, 0);
MAKE_VECTOR_PUSH_LOOP:
	CMP(R5, R1);
	JUMP_EQ(MAKE_VECTOR_AFTER_PUSH);
	PUSH(R2);
	ADD(R5, 1);
	JUMP(MAKE_VECTOR_PUSH_LOOP);
MAKE_VECTOR_AFTER_PUSH:
	PUSH(R1);
	CALL(MAKE_SOB_VECTOR);
	POP(R1);
	DROP(R1);
	POP(R5);
	POP(R2);
	POP(R1);
	JUMP(END);

PAIRS:

CONS:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	MOV(R1, FPARG(2));
	MOV(R2, FPARG(3));
	PUSH(R2);
	PUSH(R1);
	CALL(MAKE_SOB_PAIR);
	DROP(2);
	POP(R2);
	POP(R1);
	JUMP(END);

CAR:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	MOV(R1, FPARG(2));
	MOV(R1, INDD(R1, 1));
	MOV(R0, R1);
	POP(R2);
	POP(R1);
	JUMP(END);

CDR:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	MOV(R1, FPARG(2));
	MOV(R1, INDD(R1, 2));
	MOV(R0, R1);
	POP(R2);
	POP(R1);
	JUMP(END);

SET_CAR:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	MOV(R1, FPARG(2));
	MOV(R2, FPARG(3));
	MOV(INDD(R1, 1), R2);
	MOV(R0, SOB_VOID);
	POP(R2);
	POP(R1);
	JUMP(END);

SET_CDR:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	MOV(R1, FPARG(2));
	MOV(R2, FPARG(3));
	MOV(INDD(R1, 2), R2);
	MOV(R0, SOB_VOID);
	POP(R2);
	POP(R1);
	JUMP(END);

LISTS:

LIST:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R5);
	PUSH(R6);
	PUSH(R7);
	PUSH(R8);
	PUSH(R10);
	PUSH(R11);
	MOV(R5, FPARG(NUMOFARGS)); 
	MOV(R6, 0);	
	MOV(R7, 2);
	CMP(0, R5);
	JUMP_NE(LIST_CREATE_NODES);	
	PUSH(1);
	CALL(MALLOC);
	DROP(1);
	MOV(R0, SOB_NIL);
	JUMP(LIST_END);
LIST_CREATE_NODES:
	CMP(R5, R6);
	JUMP_EQ(LIST_LAST_ELEMENT);
	PUSH(3);
	CALL(MALLOC);
	DROP(1);
	MOV(R10, R0);
	MOV(INDD(R10, 0), T_PAIR);
	MOV(INDD(R10, 1), FPARG(R7));
	CMP(R6, 0);
	JUMP_EQ(LIST_FIRST);
	MOV(INDD(R11, 2), R10);
	JUMP(LIST_CONTINUE);
LIST_FIRST:
	MOV(R8, R10);
LIST_CONTINUE:
	MOV(R11, R10);
	ADD(R6, 1);
	ADD(R7, 1);
	JUMP(LIST_CREATE_NODES);
LIST_LAST_ELEMENT:
	MOV(INDD(R11, 2), SOB_NIL);
	MOV(R0, R8);
LIST_END:
	POP(R11);
	POP(R10);
	POP(R8);
	POP(R7);
	POP(R6);
	POP(R5);
	JUMP(END);

LIST_LENGTH:
	PUSH(FP);
	MOV(FP,SP);
	PUSH(R1);
	PUSH(R2);
	MOV(R1, IMM(0));
	MOV(R2, FPARG(0));
LIST_LENGTH_LOOP:
	CMP(INDD(R2, 0), T_NIL);
	JUMP_EQ(LIST_LENGTH_END_LOOP);
	ADD(R1, 1);
	MOV(R2, INDD(R2, 2));
	JUMP(LIST_LENGTH_LOOP);
LIST_LENGTH_END_LOOP:
	MOV(R0, R1);
	POP(R2);   
	POP(R1);   
	JUMP(END);

CONVERTERS:

INT_TO_CHAR:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	MOV(R1, FPARG(2));
	MOV(R2, INDD(R1, 1));
	PUSH(R2);
	CALL(MAKE_SOB_CHAR);
	DROP(1);
	POP(R2);
	POP(R1);
	JUMP(END);

CHAR_TO_INT:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	MOV(R1, FPARG(2));
	MOV(R2, INDD(R1, 1));
	PUSH(R2);
	CALL(MAKE_SOB_INTEGER);
	DROP(1);
	POP(R2);
	POP(R1);
	JUMP(END);

SYMBOL_TO_STR:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R2);
	MOV(R2, FPARG(2));
	MOV(R2, INDD(R2, 1));
	MOV(R2, INDD(R2, 0));
	MOV(R0, R2);
	POP(R2);
	JUMP(END);	

STR_TO_SYMBOL:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	PUSH(R3);
	PUSH(R4);
	PUSH(R5);		
	MOV(R1, FPARG(2));
	PUSH(R1);
	CALL(MAKE_SOB_SYMBOL);
	POP(R1);
	JUMP(STR_TO_SYMBOL_END);
STR_TO_SYMBOL_END:
	POP(R5);
	POP(R4);
	POP(R3);
	POP(R2);
	POP(R1);
	JUMP(END);

/** TODO: Check for fractions/rationals what happens **/
EQ:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	PUSH(R3);
	PUSH(R4);
	PUSH(R5);	
	
	MOV(R1, FPARG(2));
	MOV(R2, FPARG(3));
	
	CMP(INDD(R1, 0), INDD(R2, 0));
	JUMP_NE(EQ_RETURN_FALSE);
	
	CMP(INDD(R1, 0), T_PAIR);
	JUMP_EQ(EQ_ADDRESS);
	CMP(INDD(R1, 0), T_STRING);
	JUMP_EQ(EQ_ADDRESS);	
	CMP(INDD(R1, 0), T_VECTOR);
	JUMP_EQ(EQ_ADDRESS);		
	CMP(INDD(R1, 0), T_CLOSURE);
	JUMP_EQ(EQ_ADDRESS);
	
	CMP(INDD(R1, 0), T_INTEGER);
	JUMP_EQ(EQ_VALUE);
	CMP(INDD(R1, 0), T_CHAR);
	JUMP_EQ(EQ_VALUE);
	CMP(INDD(R1, 0), T_SYMBOL);
	JUMP_EQ(EQ_VALUE);	
	CMP(INDD(R1, 0), T_BOOL);
	JUMP_EQ(EQ_VALUE);
		
	CMP(INDD(R1, 0), T_VOID);
	JUMP_EQ(EQ_RETURN_TRUE);	
	CMP(INDD(R1, 0), T_NIL);
	JUMP_EQ(EQ_RETURN_TRUE);		
	
	JUMP(EQ_RETURN_FALSE);

EQ_VALUE:		
	CMP(INDD(R1, 1), INDD(R2, 1));
	JUMP_EQ(EQ_RETURN_TRUE);
	JUMP(EQ_RETURN_FALSE);

EQ_ADDRESS:	
	CMP(R1, R2);
	JUMP_EQ(EQ_RETURN_TRUE);
	JUMP(EQ_RETURN_FALSE);

EQ_RETURN_FALSE:
	MOV(R0, SOB_FALSE);
	JUMP(EQ_END);

EQ_RETURN_TRUE:
	MOV(R0, SOB_TRUE);
	JUMP(EQ_END);
	
EQ_END:
	POP(R5);
	POP(R4);
	POP(R3);
	POP(R2);
	POP(R1);
	JUMP(END);

WRITE_SOB_SYMBOL:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	PUSH(R3);
	MOV(R0, FPARG(0));
	MOV(R0, INDD(R0, 1));
	MOV(R0, INDD(R0, 0));
	MOV(R1, INDD(R0, 1));
	MOV(R2, R0);
	ADD(R2, IMM(2));
 WSS_LOOP_SYMBOL:
	CMP(R1, IMM(0));
	JUMP_EQ(WSS_EXIT_SYMBOL);
	CMP(IND(R2), '\n');
	JUMP_EQ(WSS_NEWLINE_SYMBOL);
	CMP(IND(R2), '\t');
	JUMP_EQ(WSS_TAB_SYMBOL);
	CMP(IND(R2), '\f');
	JUMP_EQ(WSS_PAGE_SYMBOL);
	CMP(IND(R2), '\r');
	JUMP_EQ(WSS_RETURN_SYMBOL);
	CMP(IND(R2), '\\');
	JUMP_EQ(WSS_BACKSLASH_SYMBOL);
	CMP(IND(R2), '\"');
	JUMP_EQ(WSS_DQUOTE_SYMBOL);
	CMP(IND(R2), ' ');
	JUMP_LT(WSS_OCT_CHAR_SYMBOL);
	PUSH(IND(R2));
	CALL(PUTCHAR);
	DROP(1);
	JUMP(WSS_LOOP_CONT_SYMBOL);
 WSS_DQUOTE_SYMBOL:
	PUSH(IMM('\\'));
	CALL(PUTCHAR);
	PUSH(IMM('\"'));
	CALL(PUTCHAR);
	DROP(2);
	JUMP(WSS_LOOP_CONT_SYMBOL);
 WSS_BACKSLASH_SYMBOL:
	PUSH(IMM('\\'));
	CALL(PUTCHAR);
	PUSH(IMM('\\'));
	CALL(PUTCHAR);
	DROP(2);
	JUMP(WSS_LOOP_CONT_SYMBOL);
 WSS_RETURN_SYMBOL:
	PUSH(IMM('\\'));
	CALL(PUTCHAR);
	PUSH(IMM('r'));
	CALL(PUTCHAR);
	DROP(2);
	JUMP(WSS_LOOP_CONT_SYMBOL);
 WSS_PAGE_SYMBOL:
	PUSH(IMM('\\'));
	CALL(PUTCHAR);
	PUSH(IMM('f'));
	CALL(PUTCHAR);
	DROP(2);
	JUMP(WSS_LOOP_CONT_SYMBOL);
 WSS_TAB_SYMBOL:
	PUSH(IMM('\\'));
	CALL(PUTCHAR);
	PUSH(IMM('t'));
	CALL(PUTCHAR);
	DROP(2);
	JUMP(WSS_LOOP_CONT_SYMBOL);  
 WSS_NEWLINE_SYMBOL:
	PUSH(IMM('\\'));
	CALL(PUTCHAR);
	PUSH(IMM('n'));
	CALL(PUTCHAR);
	DROP(2);
	JUMP(WSS_LOOP_CONT_SYMBOL);
 WSS_OCT_CHAR_SYMBOL:
	MOV(R0, IND(R2));
	MOV(R3, R0);
	REM(R3, IMM(8));
	PUSH(R3);
	DIV(R0, IMM(8));
	MOV(R3, R0);
	REM(R3, IMM(8));
	PUSH(R3);
	DIV(R0, IMM(8));
	REM(R0, IMM(8));
	PUSH(R0);
	PUSH(IMM('\\'));
	CALL(PUTCHAR);
	DROP(1);
	CALL(WRITE_INTEGER);
	DROP(1);
	CALL(WRITE_INTEGER);
	DROP(1);
	CALL(WRITE_INTEGER);
	DROP(1);
 WSS_LOOP_CONT_SYMBOL:
	INCR(R2);
	DECR(R1);
	JUMP(WSS_LOOP_SYMBOL);
 WSS_EXIT_SYMBOL:
	POP(R3);
	POP(R2);
	POP(R1);
	JUMP(END);

NOT:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	MOV(R1, FPARG(2));
	CMP(INDD(R1, 0), T_BOOL);
	JUMP_NE(NOT_RETURN_FALSE);
 	CMP(R1, IMM(FALSE));
 	JUMP_EQ(NOT_RETURN_TRUE);
NOT_RETURN_FALSE:
 	MOV(R0,IMM(FALSE));
 	JUMP(NOT_END);
NOT_RETURN_TRUE:
 	MOV(R0,IMM(TRUE));
NOT_END:
 	POP(R1);
 	POP(FP);
 	RETURN;

FRACTIONS:

DENOMINATOR:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	MOV(R1, FPARG(2));
	CMP(INDD(R1, 0), T_FRAC);
	JUMP_EQ(DENOMERATOR_FRAC);
	PUSH(INDD(R1, 1));
	PUSH(1);
	CALL(MAKE_SOB_FRAC);
	DROP(2);
	MOV(R1, R0);
DENOMERATOR_FRAC:
	MOV(R0, INDD(R1, 2));
	PUSH(R0);
	CALL(MAKE_SOB_INTEGER);
	DROP(1);
	POP(R1);
	POP(FP);
	RETURN;

NUMERATOR:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	MOV(R1, FPARG(2));
	CMP(INDD(R1, 0), T_FRAC);
	JUMP_EQ(NUMERATOR_FRAC);
	PUSH(INDD(R1, 1));
	PUSH(1);
	CALL(MAKE_SOB_FRAC);
	DROP(2);
	MOV(R1, R0);
NUMERATOR_FRAC:
	MOV(R0, INDD(R1, 1));
	PUSH(R0);
	CALL(MAKE_SOB_INTEGER);
	DROP(1);
	POP(R1);
	POP(FP);
	RETURN;

APPLY:
	PUSH(FP);
	MOV(FP,SP);
	MOV(R0, IMM(0)); 
	MOV(R12, FPARG(2));
	MOV(R13, FPARG(3));
	MOV(R14, FPARG(-1));
	MOV(R8, IMM(0));
	MOV(R9, IMM(1));
	PUSH(R13);
	CALL(LIST_LENGTH);
	DROP(1);
	MOV(R8, R0);
CHANGE_STACK:
	POP(FP);
	SUB(SP, IMM(5));
	ADD(SP, IMM(3));
	ADD(SP, R8);
	PUSH(FP);
	MOV(FP,SP);
	MOV(FPARG(-1), R14);
	MOV(FPARG(0), INDD(R12, 1));
	MOV(FPARG(1), R8);
	MOV(R8, IMM(2));
PUSH_ARGS:
	CMP(INDD(R13, 0), T_NIL);
	JUMP_EQ(CONT);
	MOV(FPARG(R8), INDD(R13, 1)); 
	MOV(R13, INDD(R13, 2));   
	INCR(R8);
	JUMP(PUSH_ARGS);
CONT:
	POP(FP);
	JUMPA(INDD(R12, 2));  
GET_ARG_FROM_LST:
	PUSH(FP);
	MOV(FP, SP);
	PUSH(R1);
	PUSH(R2);
	PUSH(R3);
	MOV(R1, FPARG(0)); 
	MOV(R2, FPARG(1));
	MOV(R3, IMM(0));
GET_ARG_FROM_LST_LOOP:
	CMP(R3, R1);
	JUMP_EQ(GET_ARG_FROM_LST_END);
	MOV(R2, INDD(R2, 2));
	ADD(R3, IMM(1));
	JUMP(GET_ARG_FROM_LST_LOOP);
GET_ARG_FROM_LST_END:
  	MOV(R0, INDD(R2, 1));
  	POP(R3);
	POP(R2);
  	POP(R1);
  	JUMP(END);


END:
 	POP(FP);
	RETURN;